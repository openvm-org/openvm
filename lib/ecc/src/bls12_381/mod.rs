use axvm::moduli_setup;
use axvm_algebra::{Field, IntMod};

mod fp12;
mod fp2;
mod pairing;

pub use fp12::*;
pub use fp2::*;
use hex_literal::hex;

use crate::pairing::PairingIntrinsics;

pub struct Bls12_381;

#[cfg(all(test, feature = "halo2curves", not(target_os = "zkvm")))]
mod tests;

moduli_setup! {
    Bls12_381Fp { modulus = "0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab" },
}

pub type Fp = Bls12_381Fp;

impl Field for Fp {
    type SelfRef<'a> = &'a Self;
    const ZERO: Self = <Self as IntMod>::ZERO;
    const ONE: Self = <Self as IntMod>::ONE;

    fn double_assign(&mut self) {
        IntMod::double_assign(self);
    }

    fn square_assign(&mut self) {
        IntMod::square_assign(self);
    }
}

impl PairingIntrinsics for Bls12_381 {
    type Fp = Fp;
    type Fp2 = Fp2;
    type Fp12 = Fp12;

    const PAIRING_IDX: usize = 1;
    const XI: Fp2 = Fp2::new(Fp::from_const_u8(1), Fp::from_const_u8(1));
    const FROBENIUS_COEFFS: [[Self::Fp2; 5]; 12] = [
        [
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
                  c1: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"))
            },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("b85f2392ed75078d3d81e7633da57ef6c4b9ba84d743247b4f5fbd3cfd03d60f1f0d2c20b4be31c26706bb02bfd30419")),
            c1: Bls12_381Fp(hex!("
            f34adc6d128af72cc27e6c4dc15a2d285f3cf671c98e0cec6fb3c7b68747a154b89f1f2302e9e98832e0c4362b3efc00")) },
            Fp2 { c0: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")) },
            Fp2 { c0: Bls12_381Fp(hex!("09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")),
            c1: Bls12_381Fp(hex!("
            09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")) },
            Fp2 { c0: Bls12_381Fp(hex!("adaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("16810780e9fa189b32877f256e3e3ac666059c8e4ddfea8bee8f0b0c241698f345e0b1486bfa47dfd85f3a01d9cfb205")),
            c1: Bls12_381Fp(hex!("
            9529f87f1605e61ecd78d48b90c17158bdf0146853f345dbd08279e76035df7091cc99fa4aadd36bc186453811424e14")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("fffffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("adaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")),
            c1: Bls12_381Fp(hex!("
            09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")) },
            Fp2 { c0: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")),
            c1: Bls12_381Fp(hex!("
            a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")) },
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")),
            c1: Bls12_381Fp(hex!("
            a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("9529f87f1605e61ecd78d48b90c17158bdf0146853f345dbd08279e76035df7091cc99fa4aadd36bc186453811424e14")),
            c1: Bls12_381Fp(hex!("
            16810780e9fa189b32877f256e3e3ac666059c8e4ddfea8bee8f0b0c241698f345e0b1486bfa47dfd85f3a01d9cfb205")) },
            Fp2 { c0: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")),
            c1: Bls12_381Fp(hex!("
            09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")) },
            Fp2 { c0: Bls12_381Fp(hex!("fffffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("f34adc6d128af72cc27e6c4dc15a2d285f3cf671c98e0cec6fb3c7b68747a154b89f1f2302e9e98832e0c4362b3efc00")),
            c1: Bls12_381Fp(hex!("
            b85f2392ed75078d3d81e7633da57ef6c4b9ba84d743247b4f5fbd3cfd03d60f1f0d2c20b4be31c26706bb02bfd30419")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("f34adc6d128af72cc27e6c4dc15a2d285f3cf671c98e0cec6fb3c7b68747a154b89f1f2302e9e98832e0c4362b3efc00")),
            c1: Bls12_381Fp(hex!("
            b85f2392ed75078d3d81e7633da57ef6c4b9ba84d743247b4f5fbd3cfd03d60f1f0d2c20b4be31c26706bb02bfd30419")) },
            Fp2 { c0: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")) },
            Fp2 { c0: Bls12_381Fp(hex!("a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")),
            c1: Bls12_381Fp(hex!("
            a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")) },
            Fp2 { c0: Bls12_381Fp(hex!("adaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("9529f87f1605e61ecd78d48b90c17158bdf0146853f345dbd08279e76035df7091cc99fa4aadd36bc186453811424e14")),
            c1: Bls12_381Fp(hex!("
            16810780e9fa189b32877f256e3e3ac666059c8e4ddfea8bee8f0b0c241698f345e0b1486bfa47dfd85f3a01d9cfb205")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")),
            c1: Bls12_381Fp(hex!("
            a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")) },
            Fp2 { c0: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")),
            c1: Bls12_381Fp(hex!("
            09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")) },
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")),
            c1: Bls12_381Fp(hex!("
            09cce3edfb8410c8f405ec722f9967eec5419200176ef7775e43d3c2ab5d3948fe7fd16b6de331680b40ff37040eaf06")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("adaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("acaa00000000fd8bfdff494feb2794409b5fb80f65297d89d49a75897d850daa85ded463864002ec99e67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("aaaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("fffffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            ],
            [
            Fp2 { c0: Bls12_381Fp(hex!("16810780e9fa189b32877f256e3e3ac666059c8e4ddfea8bee8f0b0c241698f345e0b1486bfa47dfd85f3a01d9cfb205")),
            c1: Bls12_381Fp(hex!("
            9529f87f1605e61ecd78d48b90c17158bdf0146853f345dbd08279e76035df7091cc99fa4aadd36bc186453811424e14")) },
            Fp2 { c0: Bls12_381Fp(hex!("000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")),
            c1: Bls12_381Fp(hex!("
            fefffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")),
            c1: Bls12_381Fp(hex!("
            a2de1b12047beef10afa673ecf6644305eb41ef6896439ef60cfb130d9ed3d1cd92c7ad748c4e9e28ea68001e6035213")) },
            Fp2 { c0: Bls12_381Fp(hex!("fffffeffffff012e02000a6213d817de8896f8e63ba9b3ddea770f6a07c669ba51ce76df2f67195f0000000000000000")),
            c1: Bls12_381Fp(hex!("
            000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")) },
            Fp2 { c0: Bls12_381Fp(hex!("b85f2392ed75078d3d81e7633da57ef6c4b9ba84d743247b4f5fbd3cfd03d60f1f0d2c20b4be31c26706bb02bfd30419")),
            c1: Bls12_381Fp(hex!("
            f34adc6d128af72cc27e6c4dc15a2d285f3cf671c98e0cec6fb3c7b68747a154b89f1f2302e9e98832e0c4362b3efc00")) },
        ],
    ];
}
